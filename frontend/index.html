<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERRA-BUD</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- TERRAFORM INPUT SECTION (Anonymous Mode) -->
        <section id="terraform-input-section" class="terraform-input-section">
            <div class="terraform-input-content">
                <h2 class="section-title">Get Started</h2>
                <p class="section-description">
                    Paste your Terraform code or upload files to get an immediate cost estimate.
                </p>
                
                <div class="terraform-input-tabs">
                    <button class="input-tab active" data-tab="paste">Paste Terraform</button>
                    <button class="input-tab" data-tab="upload">Upload Files</button>
                </div>
                
                <div id="paste-tab" class="input-tab-content active">
                    <textarea 
                        id="terraform-textarea" 
                        class="terraform-textarea"
                        placeholder="Paste your Terraform configuration here...&#10;&#10;Example:&#10;resource &quot;aws_instance&quot; &quot;web&quot; {&#10;  ami           = &quot;ami-0c55b159cbfafe1f0&quot;&#10;  instance_type = &quot;t3.micro&quot;&#10;  region        = &quot;us-east-1&quot;&#10;}"
                        rows="12"
                    ></textarea>
                    <button id="estimate-from-text-btn" class="estimate-button">
                        Estimate Costs
                    </button>
                </div>
                
                <div id="upload-tab" class="input-tab-content">
                    <div class="file-upload-area" id="file-upload-area">
                        <input 
                            type="file" 
                            id="terraform-file-input" 
                            accept=".tf,.zip"
                            multiple
                            style="display: none;"
                        />
                        <div class="file-upload-prompt">
                            <span class="upload-icon">üìÅ</span>
                            <p>Click to select .tf or .zip files</p>
                            <p class="upload-hint">Or drag and drop files here</p>
                        </div>
                    </div>
                    <div id="file-list" class="file-list" style="display: none;"></div>
                    <button id="estimate-from-files-btn" class="estimate-button" style="display: none;">
                        Estimate Costs
                    </button>
                </div>
                
                <div class="github-note">
                    <p>
                        <strong>Optional:</strong> 
                        <a href="/auth/login" class="github-link">Connect GitHub</a> 
                        to analyze a repository directly.
                    </p>
                </div>
            </div>
        </section>
        
        <!-- SECTION A: HERO / SUMMARY -->
        <section class="hero-section" id="results-section" style="display: none;">
            <div class="hero-content">
                <h1 class="hero-title">Estimated Monthly Cost</h1>
                <div class="cost-display">
                    <span id="total-cost" class="cost-amount">$0.00</span>
                    <span class="estimate-badge">Assumption-based estimate</span>
                </div>
                <p class="hero-subtext">
                    Based on your infrastructure configuration and pricing assumptions
                </p>
                <div class="hero-actions">
                    <div class="export-controls">
                        <button id="export-btn" class="export-button" aria-label="Export estimate">
                            <span class="export-icon">üì•</span>
                            <span class="export-label">Export</span>
                            <span class="export-arrow">‚ñº</span>
                        </button>
                        <div id="export-dropdown" class="export-dropdown" style="display: none;">
                            <button id="export-csv-btn" class="export-option">
                                <span class="export-option-icon">üìä</span>
                                Export CSV
                            </button>
                            <button id="export-pdf-btn" class="export-option">
                                <span class="export-option-icon">üìÑ</span>
                                Export PDF
                            </button>
                        </div>
                    </div>
                    <button id="share-btn" class="share-button" aria-label="Share estimate">
                        <span class="share-icon">üîó</span>
                        <span class="share-label">Share</span>
                    </button>
                </div>
                <div class="hero-meta">
                    <div class="region-container">
                        <div class="region-pill" id="region-pill">
                            <span class="region-label">Region:</span>
                            <span id="region" class="region-value">-</span>
                            <span class="region-chevron">‚ñº</span>
                        </div>
                        <div id="region-dropdown" class="region-dropdown" style="display: none;">
                            <div class="region-dropdown-header">Compare with region:</div>
                            <div class="region-options" id="region-options">
                                <!-- Region options rendered here -->
                            </div>
                            <button id="compare-region-btn" class="compare-button" style="display: none;">
                                Compare with <span id="selected-region-name"></span>
                            </button>
                        </div>
                    </div>
                    <div class="traffic-assumptions">
                        <label for="users-input" class="traffic-label">Traffic Assumptions (Optional)</label>
                        <input 
                            type="number" 
                            id="users-input" 
                            name="users-input" 
                            placeholder="Average users/month"
                            min="0"
                            class="traffic-input"
                        />
                        <span class="traffic-helper">Only affects request-based services when applicable</span>
                    </div>
                    <div class="coverage-badges" id="coverage-badges">
                        <!-- Coverage badges rendered here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- SCENARIO RESULT BANNER -->
        <section id="scenario-banner" class="scenario-banner" style="display: none;">
            <div class="scenario-banner-content">
                <div class="scenario-banner-header">
                    <span class="scenario-label">Scenario Active</span>
                    <button id="reset-scenario-btn" class="reset-button">Reset to Base Estimate</button>
                </div>
                <div class="scenario-assumptions" id="scenario-assumptions">
                    <!-- Scenario assumptions rendered here -->
                </div>
            </div>
        </section>

        <!-- SECTION B: COST DRIVERS -->
        <section class="cost-drivers-section">
            <h2 class="section-title">Where Your Costs Go</h2>
            <p class="section-description">Click a category to see detailed breakdown</p>
            <div id="cost-drivers" class="cost-drivers-grid">
                <!-- Cost driver cards rendered here -->
            </div>
        </section>

        <!-- SECTION C: DETAILED BREAKDOWN (Expandable) -->
        <section class="breakdown-section">
            <div class="breakdown-header">
                <h2 class="section-title">Detailed Breakdown</h2>
                <button id="toggle-breakdown" class="expand-button" aria-expanded="false">
                    <span class="button-text">Show Details</span>
                    <span class="button-icon">‚ñº</span>
                </button>
            </div>
            <div id="breakdown-content" class="breakdown-content" style="display: none;">
                <div class="table-container">
                    <table id="cost-table" class="cost-table">
                        <thead>
                            <tr>
                                <th>Cloud</th>
                                <th>Service</th>
                                <th>Resource Name</th>
                                <th>Region</th>
                                <th class="cost-column">Monthly Cost (USD)</th>
                                <th>Confidence</th>
                                <th>Assumptions</th>
                            </tr>
                        </thead>
                        <tbody id="cost-table-body">
                            <!-- Table rows rendered here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Unpriced Resources -->
                <div id="unpriced-section" class="unpriced-section">
                    <h3 class="subsection-title">Unpriced / Missing Information</h3>
                    <p class="unpriced-notice">
                        <strong>Note:</strong> These resources are NOT included in the total cost estimate.
                    </p>
                    <div id="unpriced-resources" class="unpriced-list">
                        <!-- Unpriced resources rendered here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION D: SCENARIO COMPARISON -->
        <section id="scenario-comparison-section" class="scenario-comparison-section" style="display: none;">
            <h2 class="section-title">Scenario Comparison</h2>
            <div class="comparison-grid">
                <div class="comparison-card base-estimate">
                    <div class="comparison-card-header">
                        <span class="comparison-label">Base Estimate</span>
                        <span id="base-cost" class="comparison-cost">$0.00</span>
                    </div>
                    <div class="comparison-region" id="base-region">-</div>
                </div>
                <div class="comparison-card scenario-estimate">
                    <div class="comparison-card-header">
                        <span class="comparison-label">Scenario Estimate</span>
                        <span id="scenario-cost" class="comparison-cost">$0.00</span>
                    </div>
                    <div class="comparison-region" id="scenario-region">-</div>
                    <div id="scenario-delta" class="comparison-delta">
                        <!-- Delta displayed here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION E: INSIGHTS (Advisory Tone) -->
        <section class="insights-section">
            <h2 class="section-title">Cost Insights & Suggestions</h2>
            <p class="section-description">Advisory insights to help optimize your infrastructure costs</p>
            <div id="insights-container" class="insights-grid">
                <!-- Insight cards rendered here -->
            </div>
        </section>

        <!-- AI Key Input Section -->
        <section id="ai-key-section" class="ai-key-section">
            <h2 class="section-title">AI Configuration (Optional)</h2>
            <div class="ai-key-input-group">
                <label for="ai-api-key">AI API Key</label>
                <input 
                    type="password" 
                    id="ai-api-key" 
                    name="ai-api-key" 
                    placeholder="Enter your Mistral AI API key (optional)"
                    autocomplete="off"
                />
                <p class="ai-key-helper">
                    Use your own AI key to run analysis. Your key is never stored.
                </p>
            </div>
        </section>
    </div>

    <!-- SHARE MODAL -->
    <div id="share-modal" class="share-modal" role="dialog" aria-labelledby="share-title" aria-modal="true" style="display: none;">
        <div class="share-modal-overlay"></div>
        <div class="share-modal-content">
            <div class="share-header">
                <h2 id="share-title" class="share-title">Share Estimate</h2>
                <button class="share-close" aria-label="Close share modal" id="share-close-btn">
                    <span aria-hidden="true">√ó</span>
                </button>
            </div>
            <div class="share-body">
                <p class="share-description">
                    Create a read-only link to share this estimate with your team.
                    The link will expire in 24 hours.
                </p>
                <div class="share-url-container">
                    <input 
                        type="text" 
                        id="share-url-input" 
                        class="share-url-input" 
                        readonly
                        placeholder="Generating share link..."
                    />
                    <button id="copy-share-url-btn" class="copy-share-url-btn" aria-label="Copy share link">
                        <span class="copy-icon">üìã</span>
                        Copy
                    </button>
                </div>
                <div id="share-status" class="share-status" style="display: none;"></div>
            </div>
            <div class="share-footer">
                <button class="share-dismiss-btn" id="share-dismiss-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- EXPLAINER MODAL -->
    <div id="explainer-modal" class="explainer-modal" role="dialog" aria-labelledby="explainer-title" aria-modal="true" style="display: none;">
        <div class="explainer-modal-overlay"></div>
        <div class="explainer-modal-content">
            <div class="explainer-header">
                <h2 id="explainer-title" class="explainer-title">How This Estimate Works</h2>
                <button class="explainer-close" aria-label="Close explainer" id="explainer-close-btn">
                    <span aria-hidden="true">√ó</span>
                </button>
            </div>
            <div class="explainer-body">
                <div class="explainer-section">
                    <h3 class="explainer-section-title">What is this estimate?</h3>
                    <p class="explainer-section-content">
                        This is an estimate of your infrastructure's monthly cost,
                        based on configuration, assumptions, and public pricing data.
                        It helps you understand potential costs before deployment.
                    </p>
                </div>

                <div class="explainer-section">
                    <h3 class="explainer-section-title">How are costs calculated?</h3>
                    <p class="explainer-section-content">
                        Your Terraform configuration is analyzed to identify resources.
                        We use official cloud provider pricing APIs to look up current rates.
                        Region and instance specifications matter‚Äîdifferent locations have different prices.
                        For autoscaling resources, we use average instance counts, not peak usage.
                    </p>
                </div>

                <div class="explainer-section">
                    <h3 class="explainer-section-title">What assumptions are involved?</h3>
                    <p class="explainer-section-content">
                        Some values are inferred when not explicitly specified.
                        Autoscaling, usage patterns, and traffic levels are estimated based on typical workloads.
                        Confidence indicators show how certain we are about each cost item.
                        Uncertainty is normal‚Äîreal infrastructure costs vary with usage.
                    </p>
                </div>

                <div class="explainer-section">
                    <h3 class="explainer-section-title">What happens when I change a scenario?</h3>
                    <p class="explainer-section-content">
                        Your base estimate never changes‚Äîit remains visible for comparison.
                        Scenarios show "what-if" comparisons side by side.
                        Deltas highlight the differences clearly with + or - indicators.
                        Nothing is applied automatically‚Äîscenarios are exploratory only.
                    </p>
                </div>

                <div class="explainer-section">
                    <h3 class="explainer-section-title">What this is not</h3>
                    <p class="explainer-section-content">
                        This is <strong>not</strong> an official cloud provider bill.
                        It is <strong>not</strong> a commitment or binding estimate.
                        It is <strong>not</strong> an optimization tool that makes changes automatically.
                        Actual costs may vary based on real usage, discounts, and provider-specific factors.
                    </p>
                </div>

                <div class="explainer-section">
                    <h3 class="explainer-section-title">How should I use this?</h3>
                    <p class="explainer-section-content">
                        Use this for early planning and design decisions.
                        Compare scenarios to understand cost trade-offs.
                        Build cost awareness before deployment.
                        Share estimates with your team for informed discussions.
                    </p>
                </div>
            </div>
            <div class="explainer-footer">
                <button class="explainer-dismiss-btn" id="explainer-dismiss-btn">Got it</button>
            </div>
        </div>
    </div>

    <!-- SECTION E: FOOTER (Grounding) -->
    <footer class="disclaimer-footer">
        <p>
            This tool provides cost estimates based on infrastructure configuration,
            assumptions, and publicly available pricing information.
            It is NOT an official cloud provider bill.
            Actual costs may vary.
        </p>
        <p class="footer-learn-more">
            <a href="#" id="learn-more-link" class="learn-more-link">Learn more about how this estimate works</a>
        </p>
    </footer>

    <script src="/static/app.js"></script>
</body>
</html>